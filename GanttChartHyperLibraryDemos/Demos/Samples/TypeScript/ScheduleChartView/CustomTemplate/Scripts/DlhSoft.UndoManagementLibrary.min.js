Bridge.assembly("DlhSoft.UndoManagementLibrary",function(){"use strict";Bridge.define("DlhSoft.UndoManagementLibrary.UndoStack",{inherits:[System.ComponentModel.INotifyPropertyChanged],completedActions:null,undoneActions:null,config:{events:{PropertyChanged:null},alias:["addPropertyChanged","System$ComponentModel$INotifyPropertyChanged$addPropertyChanged","removePropertyChanged","System$ComponentModel$INotifyPropertyChanged$removePropertyChanged"],init:function(){this.completedActions=new(System.Collections.Generic.List$1(DlhSoft.UndoManagementLibrary.UndoStack.ActionRecord));this.undoneActions=new(System.Collections.Generic.List$1(DlhSoft.UndoManagementLibrary.UndoStack.ActionRecord))}},getCanUndo:function(){return System.Linq.Enumerable.from(this.completedActions).any()},getCanRedo:function(){return System.Linq.Enumerable.from(this.undoneActions).any()},record:function(whatWasDone,howToUndo,whenWasDone){var $t,originallyCanUndo,originallyCanRedo;if(whenWasDone===void 0&&(whenWasDone=null),originallyCanUndo=this.getCanUndo(),originallyCanRedo=this.getCanRedo(),this.undoneActions.clear(),this.completedActions.insert(0,Bridge.merge(new DlhSoft.UndoManagementLibrary.UndoStack.ActionRecord,{whatWasDone:whatWasDone,howToUndo:howToUndo,whenWasDone:($t=whenWasDone,$t!=null?$t:System.Int64.clip32(System.Int64((new Date).getTime()).mul(1e4).div(System.Int64(1e4))))})),!originallyCanUndo)this.onPropertyChanged("canUndo");if(originallyCanRedo)this.onPropertyChanged("canRedo")},doAndRecord:function(whatToDo,howToUndo){var now=new Date;whatToDo();this.record(whatToDo,howToUndo,System.Int64.clip32(System.Int64(now.getTime()).mul(1e4).div(System.Int64(1e4))))},undo:function(relatedActionSpan){var originallyCanRedo,lastCompletedAction,previouslyCompletedAction;if(relatedActionSpan===void 0&&(relatedActionSpan=null),this.getCanUndo()){for(relatedActionSpan==null&&(relatedActionSpan=0),originallyCanRedo=this.getCanRedo();;)if(lastCompletedAction=System.Linq.Enumerable.from(this.completedActions).first(),this.completedActions.removeAt(0),lastCompletedAction.howToUndo(),this.undoneActions.insert(0,lastCompletedAction),previouslyCompletedAction=System.Linq.Enumerable.from(this.completedActions).firstOrDefault(null,null),previouslyCompletedAction==null||System.Nullable.gt(Bridge.Int.clip32(lastCompletedAction.whenWasDone-previouslyCompletedAction.whenWasDone),relatedActionSpan))break;if(!this.getCanUndo())this.onPropertyChanged("canUndo");if(!originallyCanRedo)this.onPropertyChanged("canRedo")}},redo:function(relatedActionSpan){var originallyCanUndo,lastUndoneAction,previouslyUndoneAction;if(relatedActionSpan===void 0&&(relatedActionSpan=null),this.getCanRedo()){for(relatedActionSpan==null&&(relatedActionSpan=0),originallyCanUndo=this.getCanUndo();;)if(lastUndoneAction=System.Linq.Enumerable.from(this.undoneActions).first(),this.undoneActions.removeAt(0),lastUndoneAction.whatWasDone(),this.completedActions.insert(0,lastUndoneAction),previouslyUndoneAction=System.Linq.Enumerable.from(this.undoneActions).firstOrDefault(null,null),previouslyUndoneAction==null||System.Nullable.gt(Bridge.Int.clip32(previouslyUndoneAction.whenWasDone-lastUndoneAction.whenWasDone),relatedActionSpan))break;if(!this.getCanRedo())this.onPropertyChanged("canRedo");if(!originallyCanUndo)this.onPropertyChanged("canUndo")}},onPropertyChanged:function(propertyName){Bridge.staticEquals(this.PropertyChanged,null)?null:this.PropertyChanged(this,new System.ComponentModel.PropertyChangedEventArgs(propertyName))}});Bridge.define("DlhSoft.UndoManagementLibrary.UndoStack.ActionRecord",{whatWasDone:null,howToUndo:null,whenWasDone:0})});